"use strict"
describe "Factory: MP3", ->
	
	# load the controller's module
	beforeEach module "audioMeta"

	# globals
	toHex = (hexArray) -> hexArray.map((hex)-> String.fromCharCode(parseInt(hex, 16))).join ""
	mp3Header = toHex [\
	"ff", "fb", "a0", "40", "00", "00", "02", "8b", "37", "52", "7d", "30", "40", "00", "55", "e7",\
	"8a", "4f", "a6", "08", "00", "08", "48", "29", "8d", "b8", "f5", "90", "11", "1e", "05", "32",\
	"b7", "1e", "f2", "42", "9d", "a7", "33", "42", "03", "12", "4a", "49", "8d", "c0", "38", "ee",\
	"39", "00", "02", "d0", "16", "25", "ab", "60", "cc", "cd", "fc", "58", "b2", "9d", "72", "11",\
	"a7", "79", "08", "73", "d3", "3b", "a1", "cf", "4c", "ef", "39", "ff", "9d", "fa", "9d", "e7",\
	"3b", "ff", "f5", "3b", "a1", "ce", "ff", "9f", "e7", "74", "03", "3c", "93", "81", "8b", "40",\
	"30", "31", "c3", "41", "f7", "ff", "fc", "31", "13", "83", "ff", "77", "e2", "77", "87", "f0",\
	"ff", "13", "bd", "b5", "83", "f3", "32", "ec", "ac", "42", "00", "9b", "69", "37", "68", "04",\
	"40", "09", "c0", "0c", "2b", "29", "08", "04", "ca", "92", "0f", "1c", "d6", "ce", "ef", "8b",\
	"00", "c0", "dc", "84", "6e", "73", "ff", "39", "e8", "de", "73", "ff", "3b", "ff", "39", "df",\
	"21", "3f", "a9", "dd", "0e", "77", "fa", "1c", "fd", "4e", "e4", "03", "03", "74", "25", "5d",\
	"0e", "79", "27", "0e", "74", "03", "16", "e4", "04", "e1", "f2", "75", "83", "ff", "d6", "0f",\
	"f2", "ef", "d6", "1f", "5e", "27", "3e", "1f", "ac", "1f", "e5", "e4", "7b", "6b", "f4", "20",\
	"24", "53", "2d", "94", "8a", "45", "a5", "2c", "d8", "83", "8e", "32", "7c", "4b", "49", "9b",\
	"89", "40", "23", "c3", "d6", "88", "25", "58", "39", "43", "0d", "9c", "87", "f1", "ba", "2d",\
	"06", "d3", "dc", "df", "47", "1b", "25", "5d", "35", "eb", "d0", "9a", "f5", "51", "3f", "9a",\
	"ba", "36", "bf", "9f", "f2", "89", "f7", "09", "7e", "9a", "3f", "34", "9e", "99", "35", "9e",\
	"5d", "89", "45", "33", "12", "64", "c4", "5a", "2d", "b9", "37", "2e", "69", "22", "f2", "79",\
	"06", "99", "39", "1d", "05", "bc", "8d", "c0", "08", "e9", "d0", "92", "2c", "0a", "d1", "94",\
	"a0", "23", "43", "78", "d4", "73", "95", "ec", "4d", "57", "46", "b2", "96", "bf", "2f", "a2"];

	id3v1 = toHex [ "54", "41", "47", "63", "61", "73", "73", "69",\
	"73", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "73", "74", "61", "6e", "64", "75", "70",\
	"37", "35", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "32", "30", "30", "33", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "47"]

	id3v2 = toHex [\
	"49", "44", "33", "03", "00", "00", "00", "00", "13", "47", "55", "46", "49", "44", "00", "00",\
	"00", "5c", "00", "00", "68", "74", "74", "70", "3a", "2f", "2f", "77", "77", "77", "2e", "63",\
	"64", "64", "62", "2e", "63", "6f", "6d", "2f", "69", "64", "33", "2f", "74", "61", "67", "69",\
	"6e", "66", "6f", "31", "2e", "68", "74", "6d", "6c", "00", "33", "43", "44", "33", "4e", "39",\
	"30", "51", "31", "33", "33", "37", "38", "37", "37", "33", "33", "56", "37", "38", "43", "36",\
	"33", "37", "35", "45", "42", "31", "35", "33", "45", "43", "46", "38", "32", "42", "45", "32",\
	"45", "32", "42", "41", "37", "44", "45", "35", "36", "34", "42", "36", "39", "42", "50", "37",\
	"54", "58", "58", "58", "00", "00", "00", "14", "00", "00", "00", "52", "69", "70", "20", "64",\
	"61", "74", "65", "00", "32", "30", "30", "37", "2d", "30", "36", "2d", "30", "39", "54", "44",\
	"41", "54", "00", "00", "00", "05", "00", "00", "00", "31", "38", "30", "36", "54", "58", "58",\
	"58", "00", "00", "00", "0a", "00", "00", "00", "53", "6f", "75", "72", "63", "65", "00", "43",\
	"44", "54", "53", "53", "45", "00", "00", "00", "05", "00", "00", "00", "4c", "41", "4d", "45",\
	"54", "58", "58", "58", "00", "00", "00", "11", "00", "00", "00", "52", "69", "70", "70", "69",\
	"6e", "67", "20", "74", "6f", "6f", "6c", "00", "45", "41", "43", "54", "58", "58", "58", "00",\
	"00", "00", "15", "00", "00", "00", "52", "65", "6c", "65", "61", "73", "65", "20", "74", "79",\
	"70", "65", "00", "41", "64", "76", "61", "6e", "63", "65", "54", "49", "54", "32", "00", "00",\
	"00", "0d", "00", "00", "00", "31", "33", "39", "74", "68", "20", "53", "74", "72", "65", "65",\
	"74", "54", "59", "45", "52", "00", "00", "00", "05", "00", "00", "00", "32", "30", "30", "37",\
	"54", "4c", "41", "4e", "00", "00", "00", "04", "00", "00", "00", "65", "6e", "67", "54", "50",\
	"55", "42", "00", "00", "00", "16", "00", "00", "00", "56", "69", "64", "5a", "6f", "6e", "65",\
	"20", "44", "69", "67", "69", "74", "61", "6c", "20", "4d", "65", "64", "69", "61", "54", "43",\
	"4f", "4e", "00", "00", "00", "0b", "00", "00", "00", "44", "65", "65", "70", "20", "48", "6f",\
	"75", "73", "65", "54", "41", "4c", "42", "00", "00", "00", "10", "00", "00", "00", "45", "6c",\
	"65", "6d", "65", "6e", "74", "73", "20", "42", "65", "79", "6f", "6e", "64", "54", "50", "45",\
	"32", "00", "00", "00", "09", "00", "00", "00", "4f", "73", "75", "6e", "6c", "61", "64", "65",\
	"4d", "43", "44", "49", "00", "00", "00", "7e", "00", "00", "41", "00", "2b", "00", "39", "00",\
	"36", "00", "2b", "00", "39", "00", "44", "00", "45", "00", "46", "00", "2b", "00", "46", "00",\
	"41", "00", "43", "00", "41", "00", "2b", "00", "31", "00", "33", "00", "45", "00", "33", "00",\
	"41", "00", "2b", "00", "32", "00", "30", "00", "32", "00", "46", "00", "36", "00", "2b", "00",\
	"32", "00", "38", "00", "39", "00", "41", "00", "38", "00", "2b", "00", "32", "00", "45", "00",\
	"38", "00", "39", "00", "35", "00", "2b", "00", "33", "00", "36", "00", "36", "00", "44", "00",\
	"43", "00", "2b", "00", "33", "00", "44", "00", "37", "00", "46", "00", "31", "00", "2b", "00",\
	"34", "00", "34", "00", "42", "00", "32", "00", "35", "00", "2b", "00", "34", "00", "44", "00",\
	"38", "00", "35", "00", "33", "00", "00", "00", "54", "50", "4f", "53", "00", "00", "00", "04",\
	"00", "00", "00", "31", "2f", "31", "54", "52", "43", "4b", "00", "00", "00", "02", "00", "00",\
	"00", "38", "50", "52", "49", "56", "00", "00", "00", "27", "00", "00", "57", "4d", "2f", "4d",\
	"65", "64", "69", "61", "43", "6c", "61", "73", "73", "50", "72", "69", "6d", "61", "72", "79",\
	"49", "44", "00", "bc", "7d", "60", "d1", "23", "e3", "e2", "4b", "86", "a1", "48", "a4", "2a",\
	"28", "44", "1e", "50", "52", "49", "56", "00", "00", "00", "29", "00", "00", "57", "4d", "2f",\
	"4d", "65", "64", "69", "61", "43", "6c", "61", "73", "73", "53", "65", "63", "6f", "6e", "64",\
	"61", "72", "79", "49", "44", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "50", "52", "49", "56", "00", "00", "00", "1f", "00", "00",\
	"57", "4d", "2f", "57", "4d", "43", "6f", "6e", "74", "65", "6e", "74", "49", "44", "00", "37",\
	"c4", "20", "52", "78", "6b", "bc", "48", "89", "fc", "be", "10", "ea", "7f", "f6", "a2", "50",\
	"52", "49", "56", "00", "00", "00", "8a", "00", "00", "57", "4d", "2f", "55", "6e", "69", "71",\
	"75", "65", "46", "69", "6c", "65", "49", "64", "65", "6e", "74", "69", "66", "69", "65", "72",\
	"00", "41", "00", "4d", "00", "47", "00", "61", "00", "5f", "00", "69", "00", "64", "00", "3d",\
	"00", "52", "00", "20", "00", "20", "00", "31", "00", "30", "00", "38", "00", "34", "00", "30",\
	"00", "32", "00", "35", "00", "3b", "00", "41", "00", "4d", "00", "47", "00", "70", "00", "5f",\
	"00", "69", "00", "64", "00", "3d", "00", "50", "00", "20", "00", "20", "00", "20", "00", "34",\
	"00", "35", "00", "39", "00", "31", "00", "34", "00", "30", "00", "3b", "00", "41", "00", "4d",\
	"00", "47", "00", "74", "00", "5f", "00", "69", "00", "64", "00", "3d", "00", "54", "00", "20",\
	"00", "31", "00", "31", "00", "39", "00", "35", "00", "32", "00", "30", "00", "35", "00", "32",\
	"00", "00", "00", "50", "52", "49", "56", "00", "00", "00", "22", "00", "00", "57", "4d", "2f",\
	"57", "4d", "43", "6f", "6c", "6c", "65", "63", "74", "69", "6f", "6e", "49", "44", "00", "c5",\
	"67", "35", "f0", "b8", "f1", "59", "4d", "b4", "9e", "14", "c3", "4e", "6e", "28", "e5", "50",\
	"52", "49", "56", "00", "00", "00", "27", "00", "00", "57", "4d", "2f", "57", "4d", "43", "6f",\
	"6c", "6c", "65", "63", "74", "69", "6f", "6e", "47", "72", "6f", "75", "70", "49", "44", "00",\
	"c5", "67", "35", "f0", "b8", "f1", "59", "4d", "b4", "9e", "14", "c3", "4e", "6e", "28", "e5",\
	"50", "52", "49", "56", "00", "00", "00", "14", "00", "00", "57", "4d", "2f", "50", "72", "6f",\
	"76", "69", "64", "65", "72", "00", "41", "00", "4d", "00", "47", "00", "00", "00", "54", "43",\
	"4f", "4d", "00", "00", "00", "09", "00", "00", "00", "4f", "73", "75", "6e", "6c", "61", "64",\
	"65", "54", "50", "45", "31", "00", "00", "00", "09", "00", "00", "00", "4f", "73", "75", "6e",\
	"6c", "61", "64", "65", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "ff", "fb", "90", "64", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	"00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00",\
	]

	# Initialize the factory
	mp3Factory = undefined
	beforeEach inject ($injector) ->
		mp3Factory = $injector.get "MP3"

	it "checks if an hex strings starts with an ID3v1 tag", ->
		isID3v1 = mp3Factory._forUnitTests.isID3v1
		expect(isID3v1(id3v1)).toBe true
		expect(isID3v1(id3v2)).toBe false
		expect(isID3v1(mp3Header)).toBe false

	it "checks if an hex strings starts with an ID3v2 tag", ->
		isID3v2 = mp3Factory._forUnitTests.isID3v2
		expect(isID3v2(id3v1)).toBe false
		expect(isID3v2(id3v2)).toBe true
		expect(isID3v2(mp3Header)).toBe false

	it "checks if an hex strings starts with an MP3 header", ->
		isMP3 = mp3Factory._forUnitTests.isMP3
		expect(isMP3(id3v1)).toBe false
		expect(isMP3(id3v2)).toBe false
		expect(isMP3(mp3Header)).toBe true

	it "retrieves bitrate from an hexString", ->
		getBitRate = mp3Factory._forUnitTests.getBitRate
		# 1111 1111 1111 1011 1010 0000
		expect(getBitRate(toHex ["ff", "fb", "a0"])).toBe 160

	it "retrieves title, artist, album from an id3v1 tag", ->
		fileInfo = {}
		mp3Factory._forUnitTests.addID3v1 id3v1, fileInfo
		expect(fileInfo.title).toBe "cassis"
		expect(fileInfo.artist).toBe "standup75"
		expect(fileInfo.album).toBeUndefined()

	it "retrives information form id3 v2 tag", ->
		deferred = {
			resolve: (->)
		}
		spyOn deferred, 'resolve'
		fileInfo = {}
		mp3Factory._forUnitTests.getAndAddID3v2 id3v2, fileInfo, null, deferred
		expect(deferred.resolve).toHaveBeenCalled()
		expect(fileInfo.title).toBe "139th Street"
		expect(fileInfo.artist).toBe "Osunlade"
		expect(fileInfo.album).toBe "Elements Beyond"

